# @configure-input@

# directory where the c source code to be transformed is located
srcdir ?= $(error no source code dir set) 

# cbiexp root directory
root ?= $(error no root dir set)
tooldir := $(root)/src/line-ids

all: idfiles

%.c.html: $(srcdir)/%.c
	source-highlight --input=$< --output=$@ --lang-def=$(tooldir)/matchlines.lang --style-file=$(tooldir)/matchlines.style --out-format=xhtml --line-number-ref --doc

%.c.ids.html: %.c.html
	xsltproc --path $(tooldir) -o $@ idlines.xsl $< 

idfiles: $(addsuffix .c.ids.html, $(notdir $(basename $(wildcard $(srcdir)/*.c))))
.PHONY: idfiles

.PHONY : clean
clean:
	-rm *.html
